<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Episode 02 - ゆるデュオ△</title>
    <!-- 共通CSSの読み込み -->
    <link rel="stylesheet" href="style.css">
    <style>
        /* --- STORY詳細 独自スタイル --- */
        
        /* 裏話ボタン（左上固定） */
        .urabana-trigger-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 50px;
            font-weight: bold;
            font-size: 0.8rem;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .urabana-trigger-btn:hover {
            transform: scale(1.1) rotate(-5deg);
            background: var(--sub-accent);
        }

        /* カルーセルエリア */
        .carousel-section {
            padding: 60px 0;
            overflow: hidden;
            background: rgba(0,0,0,0.02);
            margin-bottom: 40px;
            position: relative;
            min-height: 400px;
        }
        .carousel-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            perspective: 1000px;
            min-height: 300px;
        }
        .carousel-item {
            width: 200px;
            aspect-ratio: 16/9;
            border-radius: 12px;
            overflow: hidden;
            border: 4px solid white;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            transition: all 0.6s cubic-bezier(0.23, 1, 0.32, 1);
            cursor: pointer;
            opacity: 0.5;
            transform: scale(0.8);
            flex-shrink: 0;
        }
        .carousel-item.active {
            width: clamp(280px, 65vw, 600px);
            opacity: 1;
            transform: scale(1);
            z-index: 10;
            box-shadow: 0 20px 50px rgba(0,0,0,0.25);
            border-width: 6px;
        }
        .carousel-item img { width: 100%; height: 100%; object-fit: cover; }

        /* --- 表示切り替えロジック（!importantで強制適用） --- */
        .normal-only { display: block !important; }
        .unsung-only { display: none !important; }
        
        /* 異界モード(unsung-mode)が有効な時のスタイル */
        body.unsung-mode .normal-only { display: none !important; }
        body.unsung-mode .unsung-only { display: block !important; }
        /* グリッドレイアウトを維持するための指定 */
        body.unsung-mode .spot-grid.unsung-only { display: grid !important; }

        /* 旅のスポット */
        .spot-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }
        .spot-card {
            display: flex;
            flex-direction: column;
        }
        .spot-image {
            width: 100%;
            aspect-ratio: 16/9;
            border-radius: 12px;
            object-fit: cover;
            margin-bottom: 15px;
            border: 1px solid rgba(0,0,0,0.1);
            cursor: zoom-in;
            transition: transform 0.3s;
        }
        .spot-image:hover { transform: scale(1.02); }

        /* オーバーレイ（画像拡大） */
        .overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 5000;
            cursor: zoom-out;
        }
        .overlay img { max-width: 90%; max-height: 90%; border-radius: 8px; box-shadow: 0 0 30px rgba(255,255,255,0.1); }

        /* 裏話モーダル */
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 4000;
            padding: 20px;
            backdrop-filter: blur(8px);
        }
        .modal-content {
            background: var(--bg-color);
            width: 100%;
            max-width: 800px;
            max-height: 85vh;
            border-radius: 25px;
            overflow-y: auto;
            padding: 40px;
            position: relative;
            box-shadow: 0 25px 60px rgba(0,0,0,0.4);
            border: 2px solid var(--accent-color);
        }
        .modal-close {
            position: absolute;
            top: 20px;
            right: 25px;
            font-size: 2.5rem;
            cursor: pointer;
            color: var(--accent-color);
            line-height: 1;
        }
        .urabana-section { margin-bottom: 40px; }
        .urabana-section h3 { 
            color: var(--accent-color); 
            border-bottom: 2px dashed var(--accent-color);
            padding-bottom: 8px;
            margin-bottom: 15px;
        }

        /* 異界モード時のカルーセル加工 */
        body.unsung-mode .carousel-item img { filter: contrast(1.1) brightness(0.8) sepia(0.2) hue-rotate(-20deg); }

        @media (max-width: 768px) {
            .urabana-trigger-btn { top: 10px; left: 10px; padding: 5px 12px; font-size: 0.7rem; }
            .carousel-item { width: 80px; }
            .carousel-item.active { width: 280px; }
            .modal-content { padding: 25px; }
            .spot-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <!-- 裏話ボタン -->
    <button class="urabana-trigger-btn" onclick="toggleModal('urabana-modal', true)">
        <span>△</span> 制作秘話
    </button>

    <header class="site-header container">
        <h1 class="logo-title">ゆるデュオ△</h1>
        <nav class="main-nav">
            <a href="index.html" class="nav-item">Top</a>
            <a href="news.html" class="nav-item">News</a>
            <a href="story.html" class="nav-item active">Story</a>
            <a href="character.html" class="nav-item">Character</a>
            <a href="world.html" class="nav-item">World</a>
            <a href="movie.html" class="nav-item">Movie</a>
        </nav>
    </header>

    <main>
        <!-- エピソードタイトル -->
        <div class="container" style="text-align: center; margin-bottom: 20px;">
            <div style="font-size: 1rem; font-weight: bold; color: var(--accent-color);">Episode 02</div>
            <h2 class="normal-only" style="font-size: 2rem;">いのち の いずる くに</h2>
            <h2 class="unsung-only" style="font-size: 2rem; color: var(--accent-color);">いのち の いずる くに</h2>
        </div>

        <!-- カルーセル -->
        <section class="carousel-section">
            <div class="carousel-container" id="main-carousel">
                <!-- JavaScriptで動的に生成されます -->
            </div>
            <div style="text-align: center; margin-top: 30px; display: flex; justify-content: center; gap: 20px;">
                <button class="nav-item" style="padding: 8px 20px;" onclick="rotateCarousel(-1)">◀ Prev</button>
                <button class="nav-item" style="padding: 8px 20px;" onclick="rotateCarousel(1)">Next ▶</button>
            </div>
        </section>

        <!-- あらすじ -->
        <div class="container">
            <section class="synopsis">
                <h2 class="tape-header normal-only">あらすじ</h2>
                <h2 class="tape-header unsung-only">異界のあらすじ</h2>
                
                <!-- 日常あらすじ -->
                <div class="card normal-only">
                    <p>川根の旅から少し後、冬休みに入ったマコトちゃんたち。 この休みを利用して、彼女たちは伊豆半島一周旅行へと向かうことになりました。</p>
                    <p style="margin-top: 0.5rem;">一日目はマコトちゃん考案の西伊豆観光、二日目はなでこちゃん考案の東伊豆観光。 それぞれがそれぞれにサプライズで行き先を出し合う旅は、二人ならではの特別な時間を作ることになるはずでした。 しかし、彼女たちはこの伊豆の地で、再び異界に巻き込まれることに。 そこで彼女たちは、ある出会いを果たすのですが…。 ワイワイ遊んで、ちょっぴりほろりなシリーズ第2作、始まります。</p>
                </div>
                
                <!-- 異界あらすじ -->
                <div class="card unsung-only">
                    <p>迷い込んだ異界で出会ったのは、檻に閉じ込められていた記憶喪失の少女「シロコ」。 三人は恐竜の背に乗って海や森を巡り、大冒険の楽しい時間を過ごしますが、辿り着いた氷の城で、シロコの正体が「体を譲ってもらえなかった世界のもう一人のマコト」である蛇崩あかりだという残酷な真実を知ることになります。</p>
                    <p style="margin-top: 0.5rem;">なでこが抱えていた罪悪感と、あかりの孤独な過去に直面しながらも、マコトは自身の運命を受け入れ、あかりの最期の願いを叶えることを決意します。凍てついた病室に三人の願いで満開の河津桜を咲かせたとき、悲しい「もしも」の未来は、決して忘れることのない温かな「春の記憶」へと変わるのでした。</p>
                </div>
            </section>

            <!-- 旅のスポット -->
            <section style="margin-top: 50px;">
                <h2 class="tape-header">旅のスポット</h2>
                
                <!-- 日常パート：旅のスポット -->
                <div class="spot-grid normal-only">
                    <div class="card spot-card">
                        <img src="04_assets/Story/story02/ryuugukutu.jpg" class="spot-image" onclick="openOverlay(this)">
                        <h4>龍宮窟</h4>
                        <p>波の浸食によってできた巨大な天窓を持つ海食洞で、崖の上からは砂浜と海が重なってハートの形に見える神秘的な場所です。なでこに案内されたマコトは、その絶景を「地球が生きてきた証」と表現し、二人で大きな手作りのハートを作って記念撮影を楽しみました。</p>
                    </div>
                    <div class="card spot-card">
                        <img src="04_assets/Story/story02/kuroneiwa.jpg" class="spot-image" onclick="openOverlay(this)">
                        <h4>黒根岩風呂</h4>
                        <p>波しぶきがかかるほど海に近い場所に位置する、海抜0メートルの開放感あふれる絶景露天風呂です。マコトとなでこはここで水平線に浮かぶ伊豆大島を眺めながら入浴し、マコトが「出汁が出る〜」と冗談を言うほど心身ともにリラックスした時間を過ごしました。</p>
                    </div>
                    <div class="card spot-card">
                        <img src="04_assets/Story/story02/animalkingdam.jpg" class="spot-image" onclick="openOverlay(this)">
                        <h4>アニマルキングダム</h4>
                        <p>稲取高原にある広大なレジャーランドで、ホワイトタイガーなどの猛獣や多くの草食動物と間近で触れ合うことができます。マコトとなでこはレストランでタイガー型のバーガーを堪能した後、カピバラの「ツボ」を刺激して寝かせたり、キリンに長い舌で人参を食べさせたりして楽しみました。</p>
                    </div>
                    <div class="card spot-card">
                        <img src="04_assets/Story/story02/hosonokougen.jpg" class="spot-image" onclick="openOverlay(this)">
                        <h4>細野高原の頂上とグライダー</h4>
                        <p>太平洋や伊豆の景色を一望できる開放的な標高の高原で、空を鳥のように飛ぶタンデムフライトの体験が可能です。なでこからのサプライズでグライダーに乗ることになったマコトは、インストラクターと共に大空へ飛び立ち、上空から自分たちが巡った伊豆の景色を見渡して大興奮しました。</p>
                    </div>
                    <div class="card spot-card">
                        <img src="04_assets/Story/story02/photo_3_1.jpg" class="spot-image" onclick="openOverlay(this)">
                        <h4>細野高原のツリーハウス</h4>
                        <p>室内を本物の木が貫くユニークな設計の宿泊施設で、森の中に住んでいるような木の香りに包まれています。ここでなでこからガスランタンをクリスマスプレゼントとして贈られたマコトは、二人で小さな炎を灯しながら、素敵なプレゼントを嬉しそうに受け取っていました。</p>
                    </div>
                    <div class="card spot-card">
                        <img src="04_assets/Story/story02/moonbridge.jpg" class="spot-image" onclick="openOverlay(this)">
                        <h4>ムーンブリッジ</h4>
                        <p>夜の海面に月の光が反射して、水平線の向こうまでまっすぐな橋のように見える幻想的な自然現象です。異界から帰還したマコトとなでこはこの光景を「最後の贈り物」として眺め、マコトのポケットに残された桜の枝を手に、あかりのことを一生忘れないと誓い合いました。</p>
                    </div>
                </div>

                <!-- 異界パート：旅のスポット（日常モードでは非表示） -->
                <div class="spot-grid unsung-only">
                    <div class="card spot-card">
                        <img src="04_assets/Story/story02/ikai1.png" class="spot-image" onclick="openOverlay(this)">
                        <h4 style="color: var(--accent-color);">まっくらやみのどうくつ</h4>
                        <p>ぬかるんだ地面にごつごつとした岩場が続く、不気味ながらも神秘的な雰囲気の漂う広大な洞窟です。なでこを追って入ったマコトは、そこで出会ったなでこと息を合わせて二つのスイッチを同時に押し、檻に閉じ込められていた幼い少女「シロコ」を救い出しました。</p>
                    </div>
                    <div class="card spot-card">
                        <img src="04_assets/Story/story02/ikai2.png" class="spot-image" onclick="openOverlay(this)">
                        <h4 style="color: var(--accent-color);">お日さまぴかぴか夏のビーチ</h4>
                        <p>太陽が輝き水の透明度も高い美しい砂浜ですが、なぜか暑さを全く感じない不思議な場所です。マコト、なでこ、シロコの三人は恐竜の背に乗ってここを訪れ、海の家で見つけたシャチの浮き輪で海に繰り出し、本当の家族のように仲良く遊びました。</p>
                    </div>
                    <div class="card spot-card">
                        <img src="04_assets/Story/story02/ikai3.png" class="spot-image" onclick="openOverlay(this)">
                        <h4 style="color: var(--accent-color);">夕ぐれ空の秋の森</h4>
                        <p>同じ景色が延々と続く、時間が止まったかのような秋の装いの深い森です。恐竜の上でマコトがシロコに自分の過去（体をなでこから譲り受けた経緯）を話して聞かせる中、マコトは持ち前の観察力で木々の隙間に差し込む光を見つけ、迷宮のような森から一行を脱出させました。</p>
                    </div>
                    <div class="card spot-card">
                        <img src="04_assets/Story/story02/ikai4.jpeg" class="spot-image" onclick="openOverlay(this)">
                        <h4 style="color: var(--accent-color);">夜の冷たい冬の城</h4>
                        <p>雪化粧を施された山の頂上に建つ、一面が氷に覆われたひっそりと寂しい印象の城です。この城のベッドがある部屋に辿り着いた際、シロコは自分の正体が「体を譲ってもらえなかったもう一人のマコト」である蛇崩あかりだと思い出し、なでこもまた異界の真実に触れて涙を流しました。</p>
                    </div>
                    <div class="card spot-card">
                        <img src="04_assets/Story/story02/ikai5.gif" class="spot-image" onclick="openOverlay(this)">
                        <h4 style="color: var(--accent-color);">春</h4>
                        <p>あかりがずっと夢見ていた「家族でのお花見」を叶えるために、三人の強い願いが作り出した奇跡の空間です。マコトとなでことあかりは桜の景色を強くイメージし、冷たい病院の中に満開の河津桜を咲かせ、三人で最高の思い出を作りました。</p>
                    </div>
                </div>
            </section>
        </div>

        <div style="text-align: center; margin: 80px 0;">
            <a href="story.html" class="nav-item">ストーリー一覧に戻る</a>
        </div>
    </main>

    <!-- 裏話モーダル -->
    <div id="urabana-modal" class="modal" onclick="toggleModal('urabana-modal', false)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="modal-close" onclick="toggleModal('urabana-modal', false)">&times;</span>
            <h2 class="tape-header">Urabana - 制作秘話</h2>
            
            <div class="urabana-section" style="margin-top: 30px;">
                <h3>あかり（シロコ）のデザインについて</h3>
                <p>あかりはマコトの「もしも」の姿としてデザインされました。機械の体を得られなかった彼女の孤独と、最期の春への願いをシナリオの軸に据えています。</p>
                <img src="04_assets/Story/story02/2main.png" style="width: 100%; border-radius: 12px; margin-top: 15px;" onclick="openOverlay(this)">
            </div>

            <div class="urabana-section">
                <h3>システムについて：感情の波</h3>
                <p>今回の異界は「四季」を巡る構造にしました。楽しかった夏から、真実を知る冬、そして奇跡の春へ。プレイヤーの感情の動きに合わせたロケーション設定を意識しています。</p>
            </div>
        </div>
    </div>

    <!-- 画像拡大用オーバーレイ -->
    <div id="image-overlay" class="overlay" onclick="this.style.display='none'">
        <img id="overlay-img" src="" alt="拡大画像">
    </div>

    <footer class="main-footer">
        <p>&copy; ゆるデュオ△ 制作委員会 / Unsung Duet Project</p>
    </footer>

    <!-- 異界化ボタン（右下固定） -->
    <button class="mode-toggle" title="世界を反転させる" onclick="toggleMode()">
        <span id="toggle-icon">△</span>
    </button>

    <script>
        const imageAssets = {
            normal: [
                "04_assets/Story/story02/2main.png",
                "04_assets/Story/story02/2sutil.png",
                "04_assets/Story/story02/2-1.png",
                "04_assets/Story/story02/2-2.png",
                "04_assets/Story/story02/2-3.png"
            ],
            unsung: [
                "04_assets/Story/story02/2i-1.png",
                "04_assets/Story/story02/2i-2.png",
                "04_assets/Story/story02/2i-3.png",
                "04_assets/Story/story02/2i-4.png"
            ]
        };

        let isUnsungMode = false;
        let currentIdx = 0; // 中央の画像を1枚目に設定

        // カルーセルの描画
        function renderCarousel() {
            const container = document.getElementById('main-carousel');
            container.innerHTML = '';
            const images = isUnsungMode ? imageAssets.unsung : imageAssets.normal;
            
            if (currentIdx >= images.length) currentIdx = 0;

            images.forEach((src, i) => {
                const item = document.createElement('div');
                item.className = `carousel-item ${i === currentIdx ? 'active' : ''}`;
                item.onclick = () => {
                    currentIdx = i;
                    renderCarousel();
                    openOverlay(item);
                };
                const img = document.createElement('img');
                img.src = src;
                img.alt = `Slide ${i}`;
                item.appendChild(img);
                container.appendChild(item);
            });
            
            const activeItem = container.children[currentIdx];
            if (activeItem) {
                activeItem.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
            }
        }

        // モード切替
        function toggleMode() {
            isUnsungMode = !isUnsungMode;
            document.body.classList.toggle('unsung-mode', isUnsungMode);
            document.getElementById('toggle-icon').innerText = isUnsungMode ? '●' : '△';
            
            // モード切替時に画像をリセット
            currentIdx = 0; 
            renderCarousel();
        }

        // カルーセル回転
        function rotateCarousel(dir) {
            const images = isUnsungMode ? imageAssets.unsung : imageAssets.normal;
            currentIdx = (currentIdx + dir + images.length) % images.length;
            renderCarousel();
        }

        // 画像拡大表示
        function openOverlay(el) {
            const overlay = document.getElementById('image-overlay');
            const overlayImg = document.getElementById('overlay-img');
            const sourceImg = el.tagName === 'IMG' ? el.src : el.querySelector('img').src;
            overlayImg.src = sourceImg;
            overlay.style.display = 'flex';
        }

        // モーダル表示
        function toggleModal(id, show) {
            document.getElementById(id).style.display = show ? 'flex' : 'none';
        }

        window.onload = () => {
            renderCarousel();
        };
    </script>
</body>
</html>