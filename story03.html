<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Episode 03 - ゆるデュオ△</title>
    <!-- 共通CSSの読み込み -->
    <link rel="stylesheet" href="style.css">
    <style>
        /* --- STORY詳細 独自スタイル（シリーズ共通仕様） --- */
        .urabana-trigger-btn { position: fixed; top: 20px; left: 20px; z-index: 1000; background: var(--accent-color); color: white; border: none; padding: 8px 15px; border-radius: 50px; font-weight: bold; font-size: 0.8rem; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.2); transition: all 0.3s; display: flex; align-items: center; gap: 5px; }
        .urabana-trigger-btn:hover { transform: scale(1.1) rotate(-5deg); background: var(--sub-accent); }

        .carousel-section { padding: 60px 0; overflow: hidden; background: rgba(0,0,0,0.02); margin-bottom: 40px; position: relative; min-height: 400px; }
        .carousel-container { display: flex; justify-content: center; align-items: center; gap: 15px; perspective: 1000px; min-height: 300px; }
        .carousel-item { width: 200px; aspect-ratio: 16/9; border-radius: 12px; overflow: hidden; border: 4px solid white; box-shadow: 0 10px 20px rgba(0,0,0,0.1); transition: all 0.6s; cursor: pointer; opacity: 0.5; transform: scale(0.8); flex-shrink: 0; }
        .carousel-item.active { width: clamp(280px, 65vw, 600px); opacity: 1; transform: scale(1); z-index: 10; box-shadow: 0 20px 50px rgba(0,0,0,0.25); border-width: 6px; }
        .carousel-item img { width: 100%; height: 100%; object-fit: cover; }

        .normal-only { display: block !important; }
        .unsung-only { display: none !important; }
        body.unsung-mode .normal-only { display: none !important; }
        body.unsung-mode .unsung-only { display: block !important; }

        /* スプリットレイアウト（旅のスポット） */
        .spot-list { display: flex; flex-direction: column; gap: 40px; margin-top: 30px; }
        .spot-item-split { display: flex; align-items: center; gap: 40px; background: var(--card-bg); padding: 25px; border-radius: var(--border-radius); box-shadow: 0 10px 30px rgba(0,0,0,0.03); border: 1px solid rgba(0,0,0,0.05); transition: transform 0.3s ease; }
        .spot-item-split:hover { transform: translateY(-3px); }
        .spot-item-split:nth-child(even) { flex-direction: row-reverse; }
        .spot-visual { flex: 1.2; overflow: hidden; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .spot-visual img { width: 100%; aspect-ratio: 16/9; object-fit: cover; cursor: zoom-in; transition: transform 0.5s; display: block; }
        .spot-visual img:hover { transform: scale(1.08); }
        .spot-info { flex: 1; }
        .spot-info h4 { font-size: 1.3rem; color: var(--accent-color); margin-bottom: 15px; padding-left: 10px; border-left: 5px solid var(--accent-color); }
        .spot-info p { font-size: 0.95rem; line-height: 1.8; }

        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: none; justify-content: center; align-items: center; z-index: 5000; cursor: zoom-out; }
        .overlay img { max-width: 90%; max-height: 90%; border-radius: 8px; }

        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 4000; padding: 20px; backdrop-filter: blur(8px); }
        .modal-content { background: var(--bg-color); width: 100%; max-width: 800px; max-height: 85vh; border-radius: 25px; overflow-y: auto; padding: 40px; position: relative; border: 2px solid var(--accent-color); }
        .modal-close { position: absolute; top: 20px; right: 25px; font-size: 2.5rem; cursor: pointer; color: var(--accent-color); }
        
        body.unsung-mode .carousel-item img { filter: contrast(1.1) brightness(0.8) sepia(0.2) hue-rotate(-20deg); }

        @media (max-width: 900px) { .spot-item-split, .spot-item-split:nth-child(even) { flex-direction: column; gap: 20px; } }
    </style>
</head>
<body>

    <button class="urabana-trigger-btn" onclick="toggleModal('urabana-modal', true)"><span>△</span> 制作秘話</button>

    <header class="site-header container">
        <h1 class="logo-title">ゆるデュオ△</h1>
        <nav class="main-nav">
            <a href="index.html" class="nav-item">Top</a>
            <a href="news.html" class="nav-item">News</a>
            <a href="story.html" class="nav-item active">Story</a>
            <a href="character.html" class="nav-item">Character</a>
            <a href="world.html" class="nav-item">World</a>
            <a href="movie.html" class="nav-item">Movie</a>
        </nav>
    </header>

    <main>
        <div class="container" style="text-align: center; margin-bottom: 20px;">
            <div style="font-size: 1rem; font-weight: bold; color: var(--accent-color);">Episode 03</div>
            <h2 class="normal-only" style="font-size: 2rem;">はいに しまわれた もり</h2>
            <h2 class="unsung-only" style="font-size: 2rem; color: var(--accent-color);">はいに しまわれた もり</h2>
        </div>

        <section class="carousel-section">
            <div class="carousel-container" id="main-carousel"></div>
            <div style="text-align: center; margin-top: 30px; display: flex; justify-content: center; gap: 20px;">
                <button class="nav-item" style="padding: 8px 20px;" onclick="rotateCarousel(-1)">◀ Prev</button>
                <button class="nav-item" style="padding: 8px 20px;" onclick="rotateCarousel(1)">Next ▶</button>
            </div>
        </section>

        <div class="container">
            <section class="synopsis">
                <h2 class="tape-header normal-only">あらすじ</h2>
                <h2 class="tape-header unsung-only">異界のあらすじ</h2>
                <div class="card normal-only">
                    <p>もうすぐ春がやって来そうなある冬の日、マコトちゃん達はアウトドアショップにやって来ました。目的は勿論、マコトちゃんのキャンプ道具を買うこと。お父さんからは、春になったらキャンプに行っていいとの許可を得た事で、なでこちゃんも張り切って道具選びを手伝う事になります。</p>
                    <p style="margin-top: 0.5rem;">なでこちゃんとお父さんの激甘コンビに取り囲まれながら、初めてのキャンプに向けて道具を選ぶマコトちゃん。 しかし、そんな日常の中にも異界の住人は紛れており......。 シリーズ第3作、マコトちゃんとなでこちゃんは、三度異界に足を踏み入れることになります。 そして今回、マコトちゃん達は『彼女達』と出会い、異界というモノについて知る事になるのです。</p>
                </div>
                <div class="card unsung-only">
                    <p>迷い込んだ先は、清らかな水と緑に囲まれながらも「シ」の脅威に晒されたコダマたちの森。 お腹を空かせて倒れていたコダマのレントを「カレーメシ」で救った二人は、森を救い元の世界へ帰るため、防衛ロボット「ジョウロ」の動力源となるエネルギーパックを求めて、灰の砂漠にそびえ立つピラミッドへと向かいます。</p>
                    <p style="margin-top: 0.5rem;">過酷な探索の最中、マコトの頭に響く「永劫回帰の果てに、もう一度…」という謎のメッセージと、自らの役割を全うして木に還っていくコダマたちの覚悟。 迫りくるシの波を背に、マコトとなでこは互いの手を決して離さず、世界が一巡する「カルパ」の瞬間を目指して始祖の木の頂上へと駆け抜けます。 二人の絆が枯れ果てた世界に生命の光を呼び戻したとき、別れの先に見つけたのは、少し奇妙で温かな「再会」の約束でした。</p>
                </div>
            </section>

            <section style="margin-top: 50px;">
                <h2 class="tape-header">旅のスポット</h2>
                
                <div class="spot-list normal-only">
                    <div class="spot-item-split">
                        <div class="spot-visual"><img src="04_assets/Story/story03/1aman.jpg" alt="ホテル・クレセント" onclick="openOverlay(this)"></div>
                        <div class="spot-info">
                            <h4>ホテル・クレセント</h4>
                            <p>都内に位置する高級ホテルですが、その実態は「異界」の調査や保護を行う組織、三日月財団の日本支部です。マコトとなでこはここでスタッフの麻利絵や梅子から、自分たちの存在が「バインダー」や「シフター」と呼ばれていることや、異界の仕組みについて詳しく教わりました。</p>
                        </div>
                    </div>
                    <div class="spot-item-split">
                        <div class="spot-visual"><img src="04_assets/Story/story03/2moripark.jpg" alt="モリパーク アウトドアヴィレッジ" onclick="openOverlay(this)"></div>
                        <div class="spot-info">
                            <h4>モリパーク アウトドアヴィレッジ</h4>
                            <p>多数のアウトドアブランドが集結し、キャンプ用品の体験や購入ができる大型商業施設です。初めてのキャンプに向け、マコトは過保護なお父さんやなでこに囲まれながら、初めてのシュラフ(¥250,000)やチェアをウキウキ(？)しながら選びました。</p>
                        </div>
                    </div>
                    <div class="spot-item-split">
                        <div class="spot-visual"><img src="04_assets/Story/story03/3tent.png" alt="体験テント" onclick="openOverlay(this)"></div>
                        <div class="spot-info">
                            <h4>体験テント</h4>
                            <p>施設内の展示スペースに設営された、中に入って広さを体験できる本格的なテントです。マコトとなでこは展示品の椅子に座ってくつろぎ、なでこが持参したカレーメシとハヤシメシを仲良く作って堪能するという、ちょっとしたキャンプ体験を楽しみました。</p>
                        </div>
                    </div>
                    <div class="spot-item-split">
                        <div class="spot-visual"><img src="04_assets/Story/story03/4moroparknight.jpg" alt="帰ってきた夜" onclick="openOverlay(this)"></div>
                        <div class="spot-info">
                            <h4>帰ってきた夜</h4>
                            <p>異界での冒険を終えた二人が、再び帰還した現実世界の閉館間際の施設内です。すっかり日が暮れていましたが、マコトとなでこは心配していたお父さんと合流し、異界での出来事を胸に秘めたまま、足りない道具を揃えるために再びショッピングへと戻りました。</p>
                        </div>
                    </div>
                </div>

                <div class="spot-list unsung-only">
                    <div class="spot-item-split">
                        <div class="spot-visual"><img src="04_assets/Story/story03/ikai1.png" alt="コダマの森" onclick="openOverlay(this)"></div>
                        <div class="spot-info">
                            <h4 style="color: var(--accent-color);">コダマの森</h4>
                            <p>モリパークの大きな木に吸い込まれた先で辿り着いた、清らかな水と緑に囲まれた異界です。マコトとなでこはここで空腹で倒れていた不思議な生き物「コダマ」のレントに、買いたてのキャンプ道具でお湯を沸かしてカレーメシを食べさせて救いました。</p>
                        </div>
                    </div>
                    <div class="spot-item-split">
                        <div class="spot-visual"><img src="04_assets/Story/story03/ikai2.png" alt="コダマの村" onclick="openOverlay(this)"></div>
                        <div class="spot-info">
                            <h4 style="color: var(--accent-color);">コダマの村</h4>
                            <p>木々の上に家が建てられ、植物のような種族「コダマ」たちがそれぞれの役割を持って暮らす静かな集落です。レントに案内された二人は、村長の小玉ウッドから世界が一巡する「カルパ」という現象や、森を滅ぼす「シ」の脅威、それに対抗するためのロボット「ジョウロ」やカルパを越えるための「始祖の実」について話を聞きました。</p>
                        </div>
                    </div>
                    <div class="spot-item-split">
                        <div class="spot-visual"><img src="04_assets/Story/story03/ikai3.jpg" alt="コダマ村の宿" onclick="openOverlay(this)"></div>
                        <div class="spot-info">
                            <h4 style="color: var(--accent-color);">コダマ村の宿</h4>
                            <p>人間が泊まれるよう、ふかふかの大きなダブルベッドが用意されたツリーハウスの客室です。不思議な飲み物「ソーマ」でテンションが上がってしまったなでこに対し、マコトは明日の遠征に備えて一緒に激しいストレッチを行い、無理やり体をリラックスさせて深い眠りにつきました。</p>
                        </div>
                    </div>
                    <div class="spot-item-split">
                        <div class="spot-visual"><img src="04_assets/Story/story03/ikai4.png" alt="ピラミッド" onclick="openOverlay(this)"></div>
                        <div class="spot-info">
                            <h4 style="color: var(--accent-color);">ピラミッド</h4>
                            <p>「シ」の総本山であり、不毛な灰の砂漠の中にそびえ立つ、現実世界のピラミッドに似た巨大な石造りの遺跡です。マコトとなでこはレントたちと共に内部を探索し、背後から迫る巨大な岩のトラップをマコトの機転で見事に回避しながら奥へと進みました。</p>
                        </div>
                    </div>
                    <div class="spot-item-split">
                        <div class="spot-visual"><img src="04_assets/Story/story03/ikai5.png" alt="ピラミッド最深部" onclick="openOverlay(this)"></div>
                        <div class="spot-info">
                            <h4 style="color: var(--accent-color);">ピラミッド最深部</h4>
                            <p>静謐な空気が漂う遺跡の奥底で、「ジョウロ」の動力源となる「エネルギーパック」が保管されている祭壇です。マコトがパックを回収した際、彼女の頭の中に「永劫回帰の果てに、もう一度…」という謎のメッセージが響きました。</p>
                        </div>
                    </div>
                    <div class="spot-item-split">
                        <div class="spot-visual"><img src="04_assets/Story/story03/ikai6.png" alt="砂漠" onclick="openOverlay(this)"></div>
                        <div class="spot-info">
                            <h4 style="color: var(--accent-color);">砂漠</h4>
                            <p>シの浸食が急速に進み、生命の痕跡が消えて全てが灰に覆われつつある絶望的なエリアです。迫りくる「シの本体」から逃げるため、戦士ソウトが殿として残り、マコトとなでこは彼の覚悟を背負ってエネルギーパックを村へと届けるため必死に駆け抜けました。</p>
                        </div>
                    </div>
                    <div class="spot-item-split">
                        <div class="spot-visual"><img src="04_assets/Story/story03/ikai7.png" alt="蘇る森" onclick="openOverlay(this)"></div>
                        <div class="spot-info">
                            <h4 style="color: var(--accent-color);">蘇る森</h4>
                            <p>「始祖の木」の頂上で実が開花し、カルパを乗り越え「シ」が消え去って生命の息吹が吹き返した美しい世界です。マコトとなでこは、木になって森を守る役割を全うしたレントたちの姿を見届けました。尤も、レントの姿はカレーメシの木になっていましたが…。</p>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <div style="text-align: center; margin: 80px 0;"><a href="story.html" class="nav-item">ストーリー一覧に戻る</a></div>
    </main>

    <div id="urabana-modal" class="modal" onclick="toggleModal('urabana-modal', false)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="modal-close" onclick="toggleModal('urabana-modal', false)">&times;</span>
            <h2 class="tape-header">Urabana - 制作秘話</h2>
            <div class="urabana-section" style="margin-top: 30px;">
                <h3>鋭意作成中</h3>
                <p>しばらくお待ちください</p>
            </div>
        </div>
    </div>

    <div id="image-overlay" class="overlay" onclick="this.style.display='none'"><img id="overlay-img" src=""></div>
    <footer class="main-footer"><p>&copy; ゆるデュオ△ 制作委員会 / Unsung Duet Project</p></footer>
    <button class="mode-toggle" onclick="toggleMode()"><span id="toggle-icon">△</span></button>

    <script>
        const imageAssets = {
            normal: ["04_assets/Story/story03/3main.png","04_assets/Story/story03/3-1.png","04_assets/Story/story03/3-2.png","04_assets/Story/story03/3-3.png"],
            unsung: ["04_assets/Story/story03/3i-1.png","04_assets/Story/story03/3i-2.png","04_assets/Story/story03/3i-3.png"]
        };
        let isUnsungMode = false, currentIdx = 0;
        function renderCarousel() {
            const container = document.getElementById('main-carousel'); container.innerHTML = '';
            const images = isUnsungMode ? imageAssets.unsung : imageAssets.normal;
            images.forEach((src, i) => {
                const item = document.createElement('div'); item.className = `carousel-item ${i === currentIdx ? 'active' : ''}`;
                item.onclick = () => { currentIdx = i; renderCarousel(); openOverlay(item); };
                const img = document.createElement('img'); img.src = src; item.appendChild(img); container.appendChild(item);
            });
            const activeItem = container.children[currentIdx];
            if (activeItem) activeItem.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
        }
        function toggleMode() { isUnsungMode = !isUnsungMode; document.body.classList.toggle('unsung-mode', isUnsungMode); document.getElementById('toggle-icon').innerText = isUnsungMode ? '●' : '△'; currentIdx = 0; renderCarousel(); }
        function rotateCarousel(dir) { const images = isUnsungMode ? imageAssets.unsung : imageAssets.normal; currentIdx = (currentIdx + dir + images.length) % images.length; renderCarousel(); }
        function openOverlay(el) { const overlay = document.getElementById('image-overlay'), overlayImg = document.getElementById('overlay-img'); overlayImg.src = el.tagName === 'IMG' ? el.src : el.querySelector('img').src; overlay.style.display = 'flex'; }
        function toggleModal(id, show) { document.getElementById(id).style.display = show ? 'flex' : 'none'; }
        window.onload = renderCarousel;
    </script>
</body>
</html>