<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Episode 04 - ゆるデュオ△</title>
    <!-- 共通CSSの読み込み -->
    <link rel="stylesheet" href="style.css">
    <style>
        /* --- STORY詳細 独自スタイル（シリーズ共通仕様） --- */
        .urabana-trigger-btn { position: fixed; top: 20px; left: 20px; z-index: 1000; background: var(--accent-color); color: white; border: none; padding: 8px 15px; border-radius: 50px; font-weight: bold; font-size: 0.8rem; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.2); transition: all 0.3s; display: flex; align-items: center; gap: 5px; }
        .urabana-trigger-btn:hover { transform: scale(1.1) rotate(-5deg); background: var(--sub-accent); }

        .carousel-section { padding: 60px 0; overflow: hidden; background: rgba(0,0,0,0.02); margin-bottom: 40px; position: relative; min-height: 400px; }
        .carousel-container { display: flex; justify-content: center; align-items: center; gap: 15px; perspective: 1000px; min-height: 300px; }
        .carousel-item { width: 200px; aspect-ratio: 16/9; border-radius: 12px; overflow: hidden; border: 4px solid white; box-shadow: 0 10px 20px rgba(0,0,0,0.1); transition: all 0.6s; cursor: pointer; opacity: 0.5; transform: scale(0.8); flex-shrink: 0; }
        .carousel-item.active { width: clamp(280px, 65vw, 600px); opacity: 1; transform: scale(1); z-index: 10; box-shadow: 0 20px 50px rgba(0,0,0,0.25); border-width: 6px; }
        .carousel-item img { width: 100%; height: 100%; object-fit: cover; }

        .normal-only { display: block !important; }
        .unsung-only { display: none !important; }
        body.unsung-mode .normal-only { display: none !important; }
        body.unsung-mode .unsung-only { display: block !important; }

        /* スプリットレイアウト（旅のスポット） */
        .spot-list { display: flex; flex-direction: column; gap: 40px; margin-top: 30px; }
        .spot-item-split { display: flex; align-items: center; gap: 40px; background: var(--card-bg); padding: 25px; border-radius: var(--border-radius); box-shadow: 0 10px 30px rgba(0,0,0,0.03); border: 1px solid rgba(0,0,0,0.05); transition: transform 0.3s ease; }
        .spot-item-split:hover { transform: translateY(-3px); }
        .spot-item-split:nth-child(even) { flex-direction: row-reverse; }
        .spot-visual { flex: 1.2; overflow: hidden; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .spot-visual img { width: 100%; aspect-ratio: 16/9; object-fit: cover; cursor: zoom-in; transition: transform 0.5s; display: block; }
        .spot-visual img:hover { transform: scale(1.08); }
        .spot-info { flex: 1; }
        .spot-info h4 { font-size: 1.3rem; color: var(--accent-color); margin-bottom: 15px; padding-left: 10px; border-left: 5px solid var(--accent-color); }
        .spot-info p { font-size: 0.95rem; line-height: 1.8; }

        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: none; justify-content: center; align-items: center; z-index: 5000; cursor: zoom-out; }
        .overlay img { max-width: 90%; max-height: 90%; border-radius: 8px; }

        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 4000; padding: 20px; backdrop-filter: blur(8px); }
        .modal-content { background: var(--bg-color); width: 100%; max-width: 800px; max-height: 85vh; border-radius: 25px; overflow-y: auto; padding: 40px; position: relative; border: 2px solid var(--accent-color); }
        .modal-close { position: absolute; top: 20px; right: 25px; font-size: 2.5rem; cursor: pointer; color: var(--accent-color); }
        
        body.unsung-mode .carousel-item img { filter: contrast(1.1) brightness(0.8) sepia(0.2) hue-rotate(-20deg); }

        @media (max-width: 900px) { .spot-item-split, .spot-item-split:nth-child(even) { flex-direction: column; gap: 20px; } }
    </style>
</head>
<body>

    <button class="urabana-trigger-btn" onclick="toggleModal('urabana-modal', true)"><span>△</span> 制作秘話</button>

    <header class="site-header container">
        <h1 class="logo-title">ゆるデュオ△</h1>
        <nav class="main-nav">
            <a href="index.html" class="nav-item">Top</a>
            <a href="news.html" class="nav-item">News</a>
            <a href="story.html" class="nav-item active">Story</a>
            <a href="character.html" class="nav-item">Character</a>
            <a href="world.html" class="nav-item">World</a>
            <a href="movie.html" class="nav-item">Movie</a>
        </nav>
    </header>

    <main>
        <div class="container" style="text-align: center; margin-bottom: 20px;">
            <div style="font-size: 1rem; font-weight: bold; color: var(--accent-color);">Episode 04</div>
            <h2 class="normal-only" style="font-size: 2rem;">せいれつなる じゅんれいしゃの さと</h2>
            <h2 class="unsung-only" style="font-size: 2rem; color: var(--accent-color);">傲慢なる正義の法廷</h2>
        </div>

        <section class="carousel-section">
            <div class="carousel-container" id="main-carousel"></div>
            <div style="text-align: center; margin-top: 30px; display: flex; justify-content: center; gap: 20px;">
                <button class="nav-item" style="padding: 8px 20px;" onclick="rotateCarousel(-1)">◀ Prev</button>
                <button class="nav-item" style="padding: 8px 20px;" onclick="rotateCarousel(1)">Next ▶</button>
            </div>
        </section>

        <div class="container">
            <section class="synopsis">
                <h2 class="tape-header normal-only">あらすじ</h2>
                <h2 class="tape-header unsung-only">異界のあらすじ</h2>
                <div class="card normal-only">
                    <p>遂にキャンプに行く...はずだったマコトちゃんとなでこちゃん。が、ユーリ先生はまだ寒さの残る今時分にはキャンプをやらせたがらず、キャンプの許可が降りませんでした。</p>
                    <p style="margin-top: 0.5rem;">その埋め合わせとして、ユーリ先生の別荘がある清里や野辺山方面に向かうことに。 そこでマコトちゃん達は、ある少女達と出会い、一緒に過ごす事になります。 八ヶ岳の絶景や甘いスイーツ、絶品料理を楽しむ彼女達でしたが、異界はそんな彼女達を飲み込みます。</p>
                    <p style="margin-top: 0.5rem; font-weight: bold;">正義を望まれ生まれた異界は、罪を覚えたものを裁く。 ――――シリーズ第4弾、開廷</p>
                </div>
                <div class="card unsung-only">
                    <p>迷い込んだ先は、霧深い森と「正義」の名の下に人々を非情に裁く奇妙な村。 なでこは、マコトに体を譲ったことへの「仄かな罪悪感」を突かれ、異端の罪人として公開処刑の危機にさらされてしまいます。 一方、イギリスから来た魔術師の少女・エヴィもまた、一族が作り出した魔術「正義の天秤」という宿命に独り苦しんでいました。</p>
                    <p style="margin-top: 0.5rem;">「なでこもエヴィも罪なんて犯していない」 マコトの想いが歪んだ法廷を打ち砕き、傲慢な審判を下す城は浄化の炎に包まれます。マコトとなでこ、二人の絆がエヴィの魔力と共鳴するとき、 罪と罰の螺旋を乗り越え、少女たちが見つけた「正義や罪よりも大切なもの」とは――。</p>
                </div>
            </section>

            <section style="margin-top: 50px;">
                <h2 class="tape-header">旅のスポット</h2>
                
                <div class="spot-list normal-only">
                    <div class="spot-item-split">
                        <div class="spot-visual"><img src="04_assets/Story/story04/1kiyosato.jpg" alt="清里駅周辺" onclick="openOverlay(this)"></div>
                        <div class="spot-info">
                            <h4>清里駅周辺</h4>
                            <p>標高1,275mに位置する山梨県の駅で、駅前広場には往年のSLが展示されています。マコトとなでこは展示されたSLを見学しながら以前の旅を懐かしみ、ポット型の建物や不思議な案山子を見つけて楽しみました。</p>
                        </div>
                    </div>
                    <div class="spot-item-split">
                        <div class="spot-visual"><img src="04_assets/Story/story04/2kiyosatotellase.jpg" alt="清里テラス" onclick="openOverlay(this)"></div>
                        <div class="spot-info">
                            <h4>清里テラス</h4>
                            <p>サンメドウズ清里の山頂にあり、富士山や野辺山高原の絶景をソファでくつろぎながら楽しめるリゾートスポットです。リフトで登ったマコトとなでこは「スカイソフト」を堪能し、そこで偶然居合わせたなでこの友人である千明、葵、ゆいの三人から熱烈な歓迎を受けました。</p>
                        </div>
                    </div>
                    <div class="spot-item-split">
                        <div class="spot-visual"><img src="04_assets/Story/story04/3utsukushimori.JPG" alt="美し森" onclick="openOverlay(this)"></div>
                        <div class="spot-info">
                            <h4>美し森</h4>
                            <p>八ヶ岳を一望できる展望台で、訪れた際はまだ雪が少し残り、澄んだ空気の中で冬の終わりの景色を堪能できる場所です。マコトとなでこは滑らないよう手を繋いで登頂し、そこで出会ったなでこの親友リンと、なでこの変化と彼女への信頼を話しました。</p>
                        </div>
                    </div>
                    <div class="spot-item-split">
                        <div class="spot-visual"><img src="04_assets/Story/story04/4seiseiryo.jpg" alt="清泉寮" onclick="openOverlay(this)"></div>
                        <div class="spot-info">
                            <h4>清泉寮</h4>
                            <p>八ヶ岳南麓に広がる、赤い三角屋根が特徴の宿泊施設や教会を備えた高原観光のシンボル的拠点です。マコトとなでこは名物のソフトクリームを味わい、そこで迷子になっていたイングランドの魔術師エヴィと出会い、共に過ごすことになりました。</p>
                        </div>
                    </div>
                    <div class="spot-item-split">
                        <div class="spot-visual"><img src="04_assets/Story/story04/5moeginomura.jpg" alt="萌木の村" onclick="openOverlay(this)"></div>
                        <div class="spot-info">
                            <h4>萌木の村</h4>
                            <p>森の中にクラフトショップやレストランが点在する、おとぎ話のような世界観の複合観光エリアです。マコト、なでこ、エヴィの三人はお揃いのストールを購入して友情の証とし、名物のビーフカレーを食べた後、メリーゴーランドに乗って絆を深めました。</p>
                        </div>
                    </div>
                    <div class="spot-item-split">
                        <div class="spot-visual"><img src="04_assets/Story/story04/6nobeyama.jpg" alt="野辺山宇宙電波天文台" onclick="openOverlay(this)"></div>
                        <div class="spot-info">
                            <h4>野辺山宇宙電波天文台</h4>
                            <p>世界最大級の45m電波望遠鏡が並ぶ、宇宙の謎を探求するための巨大なパラボラアンテナが印象的な施設です。マコトとなでこはプラネタリウムで星空を鑑賞しましたが、出口でエヴィの姿を見かけた直後、世界が暗転して異界に飲み込まれてしまいました。</p>
                        </div>
                    </div>
                </div>

                <div class="spot-list unsung-only">
                    <div class="spot-item-split">
                        <div class="spot-visual"><img src="04_assets/Story/story04/ikai1.jpg" alt="巡礼者の森" onclick="openOverlay(this)"></div>
                        <div class="spot-info">
                            <h4 style="color: var(--accent-color);">巡礼者の森</h4>
                            <p>霧に包まれ枯れ木が不気味にうねる、迷い込んだ者を拒絶するかのような暗い異界の森です。異界に足を踏み入れマコトとなでこは、背後から迫る巨大なライオンのような猛獣から逃れるため、必死に手を繋いで出口を目指しました。</p>
                        </div>
                    </div>
                    <div class="spot-item-split">
                        <div class="spot-visual"><img src="04_assets/Story/story04/ikai2.jpg" alt="正義の村" onclick="openOverlay(this)"></div>
                        <div class="spot-info">
                            <h4 style="color: var(--accent-color);">正義の村</h4>
                            <p>中世の農村のような牧歌的な外観を持ちながら、独自の正義感に基づく不穏さを孕んだ場所です。レン姉ちゃんに助けられたマコトとなでこは、村の子供たちと出会い「トリケラトプス拳」を伝授して交流を持ちましたが、後に村の「正義」の残酷さを知ることになります。</p>
                        </div>
                    </div>
                    <div class="spot-item-split">
                        <div class="spot-visual"><img src="04_assets/Story/story04/ikai3.jpg" alt="納屋" onclick="openOverlay(this)"></div>
                        <div class="spot-info">
                            <h4 style="color: var(--accent-color);">納屋</h4>
                            <p>村外れの森の近くにあり、生まれた時から「罪人」と定められた人々が家畜のように繋がれている陰惨な場所です。調査に訪れたマコトとなでこはここで不当な差別を目撃し、なでこは手に「天秤の刻印」が刻まれてしまいました。</p>
                        </div>
                    </div>
                    <div class="spot-item-split">
                        <div class="spot-visual"><img src="04_assets/Story/story04/ikai4.png" alt="礼賛/呪詛の森" onclick="openOverlay(this)"></div>
                        <div class="spot-info">
                            <h4 style="color: var(--accent-color);">礼賛/呪詛の森</h4>
                            <p>村人たちが「正義」の名の下に異端者を裁くための広場があり、狂信的な熱気に満ちた森のエリアです。なでこが絞首刑にされるという絶体絶命の危機に、マコトは毅然とした態度で村人たちを圧倒し、彼女を救い出すことに成功しました。</p>
                        </div>
                    </div>
                    <div class="spot-item-split">
                        <div class="spot-visual"><img src="04_assets/Story/story04/ikai5.jpeg" alt="裁きの間" onclick="openOverlay(this)"></div>
                        <div class="spot-info">
                            <h4 style="color: var(--accent-color);">裁きの間</h4>
                            <p>他人の罪を自分たちの正義に基づき審議し、一方的な断罪を行う「傲慢な正義」が支配するステージです。マコトはそこでなでこからの罪の告白をなかったことにし、仲間の助けも得て彼女を奪還しました。</p>
                        </div>
                    </div>
                    <div class="spot-item-split">
                        <div class="spot-visual"><img src="04_assets/Story/story04/ikai6.jpg" alt="浄化の炎" onclick="openOverlay(this)"></div>
                        <div class="spot-info">
                            <h4 style="color: var(--accent-color);">浄化の炎</h4>
                            <p>思い通りの判決を下せなかった異界の主の怒りが、世界を焼き尽くそうとする炎です。マコトとなでこは再会したエヴィが操る風の道を通って脱出を試み、マコトは自らの髪を焼いてまでも転倒したなでこを支え抜きました。</p>
                        </div>
                    </div>
                    <div class="spot-item-split">
                        <div class="spot-visual"><img src="04_assets/Story/story04/ikai7.jpg" alt="天秤の玉座" onclick="openOverlay(this)"></div>
                        <div class="spot-info">
                            <h4 style="color: var(--accent-color);">天秤の玉座</h4>
                            <p>異界の最奥にある神殿で、宿命の天秤が置かれた場所です。エヴィを救うために戻ったマコトとなでこは、三人の絆を一つにし、見事に「傲慢の天秤」を破壊して全てを終わらせました。</p>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <div style="text-align: center; margin: 80px 0;"><a href="story.html" class="nav-item">ストーリー一覧に戻る</a></div>
    </main>

    <div id="urabana-modal" class="modal" onclick="toggleModal('urabana-modal', false)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="modal-close" onclick="toggleModal('urabana-modal', false)">&times;</span>
            <h2 class="tape-header">Urabana - 制作秘話</h2>
            <div class="urabana-section" style="margin-top: 30px;">
                <h3>「正義」へのアンチテーゼ</h3>
                <p>第4話では、魔術師の少女エヴィが登場し、物語はよりファンタジー色の強いものになりました。「正義」という名の下で行われる一方的な断罪に対し、個人の絆がいかに立ち向かうかをテーマにしています。</p>
            </div>
            <div class="urabana-section">
                <h3>キャラクターの共演</h3>
                <p>なでこの友人たちやリンが登場するなど、「ゆるキャン△」ファンへのサービス要素を盛り込みつつ、シリアスな異界とのギャップを強調しました。</p>
            </div>
        </div>
    </div>

    <div id="image-overlay" class="overlay" onclick="this.style.display='none'"><img id="overlay-img" src=""></div>
    <footer class="main-footer"><p>&copy; ゆるデュオ△ 制作委員会 / Unsung Duet Project</p></footer>
    <button class="mode-toggle" onclick="toggleMode()"><span id="toggle-icon">△</span></button>

    <script>
        const imageAssets = {
            normal: [
                "04_assets/Story/story04/4main.png",
                "04_assets/Story/story04/4sutil.png",
                "04_assets/Story/story04/4-1.png",
                "04_assets/Story/story04/4-2.png",
                "04_assets/Story/story04/4-3.png"
            ],
            unsung: [
                "04_assets/Story/story04/4i-1.png",
                "04_assets/Story/story04/4i-2.png",
                "04_assets/Story/story04/4i-3.png",
                "04_assets/Story/story04/4i-4.png",
                "04_assets/Story/story04/4i-5.png"
            ]
        };
        let isUnsungMode = false, currentIdx = 0;
        function renderCarousel() {
            const container = document.getElementById('main-carousel'); container.innerHTML = '';
            const images = isUnsungMode ? imageAssets.unsung : imageAssets.normal;
            images.forEach((src, i) => {
                const item = document.createElement('div'); item.className = `carousel-item ${i === currentIdx ? 'active' : ''}`;
                item.onclick = () => { currentIdx = i; renderCarousel(); openOverlay(item); };
                const img = document.createElement('img'); img.src = src; item.appendChild(img); container.appendChild(item);
            });
            const activeItem = container.children[currentIdx];
            if (activeItem) activeItem.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
        }
        function toggleMode() { isUnsungMode = !isUnsungMode; document.body.classList.toggle('unsung-mode', isUnsungMode); document.getElementById('toggle-icon').innerText = isUnsungMode ? '●' : '△'; currentIdx = 0; renderCarousel(); }
        function rotateCarousel(dir) { const images = isUnsungMode ? imageAssets.unsung : imageAssets.normal; currentIdx = (currentIdx + dir + images.length) % images.length; renderCarousel(); }
        function openOverlay(el) { const overlay = document.getElementById('image-overlay'), overlayImg = document.getElementById('overlay-img'); overlayImg.src = el.tagName === 'IMG' ? el.src : el.querySelector('img').src; overlay.style.display = 'flex'; }
        function toggleModal(id, show) { document.getElementById(id).style.display = show ? 'flex' : 'none'; }
        window.onload = renderCarousel;
    </script>
</body>
</html>